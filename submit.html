<!DOCTYPE html>
<html>
<head>
  <title>Submit a Story</title>
  <link rel="stylesheet" href="css/submit.css">
</head>
<body>
  <header>
    <div class="logo">
      <img src="images/logo.png" alt="Unscripted Lifewriter Logo">
    </div>
    <nav>
      <ul id="links">
        <li><a href="index.html" class="btn">Blog</a></li>
        <li><a href="index.html" class="btn">Home</a></li>
        <li><a href="about.html" class="btn">About</a></li>
        <li><a href="contact.html" class="btn">Contact</a></li>
      </ul>
    </nav> 
  </header>

  <h1>Hello Sherifa, you are welcome.</h1>
  <h3>Kindly write your story</h3>

  <input type="text" id="title" placeholder="Story Title"><br><br>
  <textarea id="content" placeholder="Your story..." rows="10" cols="50"></textarea><br><br>
  <input type="file" id="image"><br><br>
  <button onclick="submitStory()" class="btn">Post Story</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBq_YkDy8uPaAVqmNLyUlNhocGp8Er9Prc",
      authDomain: "sisblog.firebaseapp.com",
      projectId: "sisblog",
      storageBucket: "sisblog.appspot.com",
      messagingSenderId: "353586425293",
      appId: "1:353586425293:web:9a81103540a665bc4e6884"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.submitStory = async function () {
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').value;
      const imageFile = document.getElementById('image').files[0];

      if (!title || !content) {
        alert("Please fill in both title and content.");
        return;
      }

      let imageUrl = "";
      if (imageFile) {
        try {
          const formData = new FormData();
          formData.append("file", imageFile);
          formData.append("upload_preset", "blog-upload");

          const response = await fetch("https://api.cloudinary.com/v1_1/desg41jv7/image/upload", {
            method: "POST",
            body: formData
          });

          const data = await response.json();
          imageUrl = data.secure_url;
        } catch (error) {
          alert("Image upload failed: " + error.message);
          return;
        }
      }

      try {
        await addDoc(collection(db, "stories"), {
          title,
          content,
          imageUrl,
          timestamp: Date.now()
        });
        alert("Story posted successfully!");
        window.location.href = "homepage.html";
      } catch (error) {
        alert("Failed to post story: " + error.message);
      }
    };
  </script>
</body>
</html>
